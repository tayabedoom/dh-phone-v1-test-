<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Firebase Connection Test</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="config.js"></script>
</head>
<body class="bg-gray-100 p-8">
    <div class="max-w-2xl mx-auto bg-white rounded-lg shadow-lg p-6">
        <h1 class="text-2xl font-bold mb-6 text-center">Firebase Connection Test</h1>
        
        <div id="status" class="mb-6 p-4 bg-gray-100 rounded">
            <h2 class="font-semibold mb-2">Status:</h2>
            <div id="status-text">Initializing...</div>
        </div>
        
        <div class="space-y-4">
            <button id="test-connection" class="w-full bg-blue-500 text-white py-2 px-4 rounded hover:bg-blue-600">
                Test Firebase Connection
            </button>
            
            <button id="test-auth" class="w-full bg-green-500 text-white py-2 px-4 rounded hover:bg-green-600">
                Test Authentication
            </button>
            
            <button id="test-firestore" class="w-full bg-purple-500 text-white py-2 px-4 rounded hover:bg-purple-600">
                Test Firestore Read
            </button>
            
            <button id="test-write" class="w-full bg-orange-500 text-white py-2 px-4 rounded hover:bg-orange-600">
                Test Firestore Write
            </button>
        </div>
        
        <div id="logs" class="mt-6 p-4 bg-gray-900 text-green-400 rounded font-mono text-sm max-h-64 overflow-y-auto">
            <div>Console logs will appear here...</div>
        </div>
    </div>

    <script type="module">
        // Import Firebase modules
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
        import { getFirestore, collection, getDocs, doc, setDoc } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-auth.js";

        const statusText = document.getElementById('status-text');
        const logsDiv = document.getElementById('logs');

        function log(message) {
            const timestamp = new Date().toLocaleTimeString();
            logsDiv.innerHTML += `<div>[${timestamp}] ${message}</div>`;
            logsDiv.scrollTop = logsDiv.scrollHeight;
            console.log(message);
        }

        function updateStatus(message, type = 'info') {
            statusText.textContent = message;
            const statusDiv = document.getElementById('status');
            statusDiv.className = `mb-6 p-4 rounded ${type === 'error' ? 'bg-red-100' : type === 'success' ? 'bg-green-100' : 'bg-gray-100'}`;
        }

        let app, db, auth;

        // Initialize Firebase
        try {
            log('Initializing Firebase...');
            app = initializeApp(window.config.firebase);
            db = getFirestore(app);
            auth = getAuth(app);
            log('Firebase initialized successfully');
            updateStatus('Firebase initialized', 'success');
        } catch (error) {
            log('Error initializing Firebase: ' + error.message);
            updateStatus('Firebase initialization failed: ' + error.message, 'error');
        }

        // Test connection button
        document.getElementById('test-connection').addEventListener('click', async () => {
            log('Testing Firebase connection...');
            try {
                if (!db) {
                    throw new Error('Firebase not initialized');
                }
                log('Firebase connection test passed');
                updateStatus('Firebase connection successful', 'success');
            } catch (error) {
                log('Firebase connection test failed: ' + error.message);
                updateStatus('Firebase connection failed: ' + error.message, 'error');
            }
        });

        // Test authentication button
        document.getElementById('test-auth').addEventListener('click', async () => {
            log('Testing authentication...');
            try {
                if (!auth) {
                    throw new Error('Firebase Auth not initialized');
                }
                
                const userCredential = await signInAnonymously(auth);
                log('Authentication successful. User ID: ' + userCredential.user.uid);
                updateStatus('Authentication successful', 'success');
            } catch (error) {
                log('Authentication failed: ' + error.message);
                updateStatus('Authentication failed: ' + error.message, 'error');
            }
        });

        // Test Firestore read button
        document.getElementById('test-firestore').addEventListener('click', async () => {
            log('Testing Firestore read...');
            try {
                if (!db) {
                    throw new Error('Firestore not initialized');
                }
                
                const testRef = collection(db, 'landingPages');
                const querySnapshot = await getDocs(testRef);
                log('Firestore read successful. Found ' + querySnapshot.size + ' documents');
                updateStatus('Firestore read successful', 'success');
            } catch (error) {
                log('Firestore read failed: ' + error.message);
                updateStatus('Firestore read failed: ' + error.message, 'error');
            }
        });

        // Test Firestore write button
        document.getElementById('test-write').addEventListener('click', async () => {
            log('Testing Firestore write...');
            try {
                if (!db) {
                    throw new Error('Firestore not initialized');
                }
                
                if (!auth.currentUser) {
                    throw new Error('Not authenticated. Please test authentication first.');
                }
                
                const testDoc = doc(db, 'test', 'connection-test');
                await setDoc(testDoc, {
                    timestamp: new Date().toISOString(),
                    test: true
                });
                log('Firestore write successful');
                updateStatus('Firestore write successful', 'success');
            } catch (error) {
                log('Firestore write failed: ' + error.message);
                updateStatus('Firestore write failed: ' + error.message, 'error');
            }
        });

        // Set up auth state listener
        if (auth) {
            onAuthStateChanged(auth, (user) => {
                if (user) {
                    log('User authenticated: ' + user.uid);
                } else {
                    log('User not authenticated');
                }
            });
        }
    </script>
</body>
</html> 